<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KOABET AI (Admin Intelligence)</title>
    
    <!-- LIBRARIES -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { background-color: #0f172a; display: flex; justify-content: center; min-height: 100vh; font-family: 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }
        #root { width: 100%; max-width: 480px; background-color: #1e293b; min-height: 100vh; box-shadow: 0 0 20px rgba(0,0,0,0.5); position: relative; padding-bottom: 80px; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        
        /* AI Pulse Animation */
        .ai-pulse { animation: pulse-glow 2s infinite; }
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(168, 85, 247, 0); }
            100% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0); }
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- CONFIGURATION ---
        const ADMIN_EMAIL = "salesluoga971@gmail.com"; 
        const ADMIN_PASSWORD = "Kakaka2003"; 
        
        const PACKAGES = [
            { id: 'daily', name: '1 Day', price: 1000, label: 'Tsh 1,000' },
            { id: 'monthly', name: '1 Month', price: 25000, label: 'Tsh 25,000' },
            { id: 'yearly', name: '1 Year', price: 250000, label: 'Tsh 250,000' },
        ];
        const VALID_ACCESS_CODES = ["KOA2025", "JUMBO1", "VIP50", "WIN100"];

        // Icons
        const EyeOpen = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path><circle cx="12" cy="12" r="3"></circle></svg>;
        const EyeClosed = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7"></path><path d="M12 17a5 5 0 0 1-5-5"></path><path d="M17 12a5 5 0 0 1-5 5"></path><path d="m2 2 20 20"></path></svg>;
        const ZapIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>;
        const BrainIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>;

        // --- SIMULATED AI ENGINE ---
        // This generates consistent stats based on team name string
        const generateTeamStats = (name) => {
            if(!name) return { att: 50, def: 50, form: 50 };
            let hash = 0;
            for (let i = 0; i < name.length; i++) hash = name.charCodeAt(i) + ((hash << 5) - hash);
            const normalize = (n) => Math.abs(n % 40) + 50; // Returns 50-90
            return {
                att: normalize(hash),
                def: normalize(hash >> 2),
                form: normalize(hash >> 4)
            };
        };

        const calculatePrediction = (home, away) => {
            const hStats = generateTeamStats(home);
            const aStats = generateTeamStats(away);
            
            // Algorithm
            const homePower = (hStats.att * 0.4) + (hStats.def * 0.3) + (hStats.form * 0.3) + 5; // +5 Home Advantage
            const awayPower = (aStats.att * 0.4) + (aStats.def * 0.3) + (aStats.form * 0.3);
            
            const total = homePower + awayPower;
            const hWin = Math.round((homePower / total) * 100);
            const aWin = Math.round((awayPower / total) * 100);
            const draw = 100 - hWin - aWin;

            // Generate Tip
            let tip = "Draw";
            let prob = draw;
            let reason = "Timu zinalingana nguvu.";

            if (hWin > aWin + 10) {
                tip = "Home Win";
                prob = hWin;
                reason = `${home} ina ushambuliaji mkali (${hStats.att}%) kuliko ulinzi wa ${away}.`;
            } else if (aWin > hWin + 10) {
                tip = "Away Win";
                prob = aWin;
                reason = `${away} wako kwenye fomu nzuri (${aStats.form}%) ugenini.`;
            } else {
                // Close match logic
                if (hStats.att > 75 && aStats.att > 75) {
                    tip = "Over 2.5";
                    prob = 75;
                    reason = "Timu zote zina safu kali za ushambuliaji.";
                } else if (hStats.def > 80 && aStats.def > 80) {
                    tip = "Under 2.5";
                    prob = 70;
                    reason = "Mechi ya kibabe, ulinzi ni imara pande zote.";
                }
            }

            return { hStats, aStats, hWin, draw, aWin, tip, prob, reason };
        };

        // --- LOCAL STORAGE MANAGER ---
        const DB = {
            getUsers: () => JSON.parse(localStorage.getItem('koa_users')) || [],
            saveUser: (user) => {
                const users = DB.getUsers();
                if(users.find(u => u.email === user.email)) throw new Error("Email already used!");
                users.push(user);
                localStorage.setItem('koa_users', JSON.stringify(users));
                localStorage.setItem('koa_current_user', JSON.stringify(user));
            },
            loginUser: (email, pass) => {
                const users = DB.getUsers();
                const user = users.find(u => u.email === email && u.password === pass);
                if (user) {
                    localStorage.setItem('koa_current_user', JSON.stringify(user));
                    return user;
                }
                throw new Error("Invalid Email or Password");
            },
            getCurrentUser: () => JSON.parse(localStorage.getItem('koa_current_user')),
            logout: () => localStorage.removeItem('koa_current_user'),
            deleteUser: (email) => {
                let users = DB.getUsers();
                users = users.filter(u => u.email !== email);
                localStorage.setItem('koa_users', JSON.stringify(users));
            },
            
            getMatches: () => JSON.parse(localStorage.getItem('koa_matches')) || [],
            addMatch: (match) => {
                const matches = DB.getMatches();
                const newMatch = { ...match, id: Date.now() };
                localStorage.setItem('koa_matches', JSON.stringify([newMatch, ...matches]));
            },
            deleteMatch: (id) => {
                const matches = DB.getMatches().filter(m => m.id !== id);
                localStorage.setItem('koa_matches', JSON.stringify(matches));
            },
            
            getVip: () => JSON.parse(localStorage.getItem('koa_vip')) || [],
            addVip: (vip) => {
                const vips = DB.getVip();
                const newVip = { ...vip, id: Date.now() };
                localStorage.setItem('koa_vip', JSON.stringify([newVip, ...vips]));
            },
            deleteVip: (id) => {
                const vips = DB.getVip().filter(v => v.id !== id);
                localStorage.setItem('koa_vip', JSON.stringify(vips));
            },
            updateUserStatus: (email, status) => {
                const users = DB.getUsers();
                const updatedUsers = users.map(u => u.email === email ? {...u, ...status} : u);
                localStorage.setItem('koa_users', JSON.stringify(updatedUsers));
                const current = DB.getCurrentUser();
                if(current && current.email === email) {
                    localStorage.setItem('koa_current_user', JSON.stringify({...current, ...status}));
                }
            }
        };

        function App() {
            const [currentUser, setCurrentUser] = useState(null);
            const [view, setView] = useState('loading'); 
            
            const [matches, setMatches] = useState([]);
            const [vipCodes, setVipCodes] = useState([]);
            const [allUsers, setAllUsers] = useState([]); 
            const [activeTab, setActiveTab] = useState('matches');
            
            const [loginForm, setLoginForm] = useState({ email: '', password: '' });
            const [regForm, setRegForm] = useState({ name: '', email: '', phone: '', password: '' });
            const [showPass, setShowPass] = useState(false);
            
            const [showPayModal, setShowPayModal] = useState(false);
            const [selectedPlan, setSelectedPlan] = useState('daily');
            const [activationCode, setActivationCode] = useState('');

            // --- ADMIN AI STATE ---
            const [aiInput, setAiInput] = useState({ home: '', away: '' });
            const [aiAnalysis, setAiAnalysis] = useState(null);

            useEffect(() => {
                refreshData();
                const savedUser = DB.getCurrentUser();
                if (savedUser) {
                    setCurrentUser(savedUser);
                    setView(savedUser.email === ADMIN_EMAIL ? 'admin' : 'user');
                } else {
                    setView('login');
                }
            }, []);
            
            const refreshData = () => {
                setMatches(DB.getMatches());
                setVipCodes(DB.getVip());
                setAllUsers(DB.getUsers());
            }

            const magicSlip = useMemo(() => {
                return matches.filter(m => parseInt(m.prob) >= 75);
            }, [matches]);

            // --- ACTIONS ---
            const handleLogin = () => {
                if (!loginForm.email || !loginForm.password) { alert("Enter details"); return; }
                if (loginForm.email.toLowerCase() === ADMIN_EMAIL.toLowerCase() && loginForm.password === ADMIN_PASSWORD) {
                    const adminUser = { name: 'Admin', email: ADMIN_EMAIL, role: 'admin', isPremium: true };
                    localStorage.setItem('koa_current_user', JSON.stringify(adminUser));
                    setCurrentUser(adminUser);
                    setView('admin');
                    return;
                }
                try {
                    const user = DB.loginUser(loginForm.email, loginForm.password);
                    setCurrentUser(user);
                    setView('user');
                } catch (e) {
                    alert(e.message);
                }
            };

            const handleRegister = () => {
                if (!regForm.name || !regForm.email || !regForm.password) { alert("Fill all fields"); return; }
                try {
                    const newUser = {
                        name: regForm.name,
                        email: regForm.email,
                        phone: regForm.phone,
                        password: regForm.password,
                        isPremium: false,
                        joined: new Date().toISOString()
                    };
                    DB.saveUser(newUser);
                    setCurrentUser(newUser);
                    setView('user');
                    alert("Account Created!");
                } catch (e) {
                    alert(e.message);
                }
            };

            const handleLogout = () => {
                DB.logout();
                setCurrentUser(null);
                setLoginForm({ email: '', password: '' });
                setView('login');
                setAiAnalysis(null);
            };

            // --- ADMIN AI ACTIONS ---
            const runAiAnalysis = () => {
                if(!aiInput.home || !aiInput.away) { alert("Enter both team names first!"); return; }
                const result = calculatePrediction(aiInput.home, aiInput.away);
                setAiAnalysis(result);
            };

            const postMatch = (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                const newMatch = {
                    league: fd.get('league'), home: fd.get('home'), away: fd.get('away'),
                    time: fd.get('time'), prediction: fd.get('prediction'), prob: fd.get('prob'),
                    aiReason: fd.get('aiReason') // Hidden field
                };
                DB.addMatch(newMatch);
                refreshData();
                e.target.reset();
                setAiInput({ home: '', away: '' });
                setAiAnalysis(null);
                alert("Match Posted with AI Analysis!");
            };

            const postVip = (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                const newVip = {
                    bookie: fd.get('bookie'), code: fd.get('code'), odds: fd.get('odds')
                };
                DB.addVip(newVip);
                refreshData();
                e.target.reset();
                alert("VIP Code Posted");
            };
            
            const deleteItem = (type, id) => {
                if(!confirm("Delete?")) return;
                if(type === 'match') DB.deleteMatch(id);
                if(type === 'vip') DB.deleteVip(id);
                refreshData();
            };

            const revokeVip = (email) => {
                if(!confirm(`Revoke VIP status for ${email}?`)) return;
                DB.updateUserStatus(email, { isPremium: false });
                refreshData();
            };

            const removeUser = (email) => {
                if(!confirm(`Delete User ${email}?`)) return;
                DB.deleteUser(email);
                refreshData();
            };

            const verifyCode = () => {
                if (VALID_ACCESS_CODES.includes(activationCode.toUpperCase())) {
                    DB.updateUserStatus(currentUser.email, { isPremium: true });
                    setCurrentUser({ ...currentUser, isPremium: true });
                    setShowPayModal(false);
                    alert("VIP Unlocked Successfully!");
                } else {
                    alert("Invalid Code");
                }
            };

            if (view === 'loading') return <div className="h-screen flex items-center justify-center text-white">Loading...</div>;

            // --- AUTH VIEW ---
            if (view === 'login' || view === 'register') {
                return (
                    <div className="bg-slate-900 min-h-screen flex flex-col items-center justify-center p-6 text-white font-sans fade-in">
                        <div className="bg-gradient-to-tr from-green-600 to-emerald-800 p-4 rounded-2xl mb-6 shadow-2xl"><span className="text-4xl">ü§ñ</span></div>
                        <h1 className="text-3xl font-black italic mb-2">KOABET <span className="text-green-500">AI</span></h1>
                        <p className="text-slate-400 text-xs mb-8">Offline AI Version v5.0</p>
                        
                        <div className="w-full max-w-sm bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl">
                            {view === 'login' ? (
                                <>
                                    <h2 className="text-xl font-bold mb-4 text-center">Login</h2>
                                    <input type="email" placeholder="Email" value={loginForm.email} onChange={e=>setLoginForm({...loginForm, email: e.target.value})} className="w-full bg-slate-900 p-3 rounded-xl mb-3 border border-slate-700 text-white" />
                                    <div className="relative mb-4">
                                        <input type={showPass?"text":"password"} placeholder="Password" value={loginForm.password} onChange={e=>setLoginForm({...loginForm, password: e.target.value})} className="w-full bg-slate-900 p-3 rounded-xl border border-slate-700 text-white" />
                                        <button onClick={()=>setShowPass(!showPass)} className="absolute right-3 top-3 text-slate-400">{showPass ? <EyeOpen/> : <EyeClosed/>}</button>
                                    </div>
                                    <button onClick={handleLogin} className="w-full bg-green-600 font-bold py-3 rounded-xl mb-4 hover:bg-green-500 transition-colors">Login</button>
                                    <p className="text-center text-sm text-slate-400">No account? <button onClick={()=>setView('register')} className="text-green-400 font-bold">Register</button></p>
                                </>
                            ) : (
                                <>
                                    <h2 className="text-xl font-bold mb-4 text-center">Create Account</h2>
                                    <input type="text" placeholder="Name" value={regForm.name} onChange={e=>setRegForm({...regForm, name: e.target.value})} className="w-full bg-slate-900 p-3 rounded-xl mb-2 border border-slate-700 text-white" />
                                    <input type="email" placeholder="Email" value={regForm.email} onChange={e=>setRegForm({...regForm, email: e.target.value})} className="w-full bg-slate-900 p-3 rounded-xl mb-2 border border-slate-700 text-white" />
                                    <input type="text" placeholder="Phone" value={regForm.phone} onChange={e=>setRegForm({...regForm, phone: e.target.value})} className="w-full bg-slate-900 p-3 rounded-xl mb-2 border border-slate-700 text-white" />
                                    <input type="password" placeholder="Password (6+ chars)" value={regForm.password} onChange={e=>setRegForm({...regForm, password: e.target.value})} className="w-full bg-slate-900 p-3 rounded-xl mb-4 border border-slate-700 text-white" />
                                    <button onClick={handleRegister} className="w-full bg-green-600 font-bold py-3 rounded-xl mb-4">Sign Up</button>
                                    <p className="text-center text-sm text-slate-400">Has account? <button onClick={()=>setView('login')} className="text-green-400 font-bold">Login</button></p>
                                </>
                            )}
                        </div>
                    </div>
                );
            }

            // --- ADMIN PANEL ---
            if (view === 'admin') {
                return (
                    <div className="bg-slate-900 min-h-screen text-white p-4 pb-20 fade-in">
                         <div className="flex justify-between items-center mb-6 border-b border-slate-700 pb-4 sticky top-0 bg-slate-900 z-10">
                            <h1 className="text-xl font-bold text-red-400">ADMIN PANEL</h1>
                            <button onClick={handleLogout} className="bg-slate-800 px-3 py-1 rounded text-xs">Logout</button>
                        </div>

                        {/* --- AI ANALYZER & MATCH POSTER (IMPROVED) --- */}
                        <div className="bg-slate-800 p-4 rounded-xl border border-blue-500/30 mb-6">
                            <h3 className="font-bold mb-3 text-blue-400 flex items-center gap-2">
                                <BrainIcon /> AI Match Analyzer
                            </h3>
                            
                            {/* AI Input */}
                            <div className="grid grid-cols-2 gap-2 mb-3">
                                <input placeholder="Home Team (e.g. Simba)" value={aiInput.home} onChange={e=>setAiInput({...aiInput, home: e.target.value})} className="bg-slate-900 p-2 rounded text-xs text-white border border-slate-700" />
                                <input placeholder="Away Team (e.g. Yanga)" value={aiInput.away} onChange={e=>setAiInput({...aiInput, away: e.target.value})} className="bg-slate-900 p-2 rounded text-xs text-white border border-slate-700" />
                            </div>
                            <button onClick={runAiAnalysis} className="w-full bg-purple-600 hover:bg-purple-500 py-2 rounded text-xs font-bold mb-4 flex items-center justify-center gap-2 ai-pulse">
                                <ZapIcon size={14}/> Generate AI Prediction
                            </button>

                            {/* AI Result Display */}
                            {aiAnalysis && (
                                <div className="bg-slate-900 p-3 rounded-lg border border-purple-500/30 mb-4 animate-bounce-in">
                                    <div className="flex justify-between text-xs text-slate-400 mb-2">
                                        <span>Attack: <b className="text-green-400">{aiAnalysis.hStats.att}%</b></span>
                                        <span>vs</span>
                                        <span>Attack: <b className="text-red-400">{aiAnalysis.aStats.att}%</b></span>
                                    </div>
                                    <div className="h-2 bg-slate-700 rounded-full overflow-hidden flex mb-2">
                                        <div className="bg-green-500" style={{width: `${aiAnalysis.hWin}%`}}></div>
                                        <div className="bg-slate-500" style={{width: `${aiAnalysis.draw}%`}}></div>
                                        <div className="bg-red-500" style={{width: `${aiAnalysis.aWin}%`}}></div>
                                    </div>
                                    <div className="flex justify-between text-[10px] text-slate-500 mb-2">
                                        <span>Win: {aiAnalysis.hWin}%</span>
                                        <span>Draw: {aiAnalysis.draw}%</span>
                                        <span>Win: {aiAnalysis.aWin}%</span>
                                    </div>
                                    <p className="text-xs text-purple-300 italic">"{aiAnalysis.reason}"</p>
                                </div>
                            )}

                            {/* Post Form (Auto-filled by AI) */}
                            <form onSubmit={postMatch} className="grid grid-cols-2 gap-2 border-t border-slate-700 pt-3">
                                <input name="league" placeholder="League" className="bg-slate-900 p-2 rounded text-xs text-white" required />
                                <input name="time" placeholder="Time" className="bg-slate-900 p-2 rounded text-xs text-white" required />
                                {/* Hidden fields populated by state/AI */}
                                <input name="home" type="hidden" value={aiInput.home} />
                                <input name="away" type="hidden" value={aiInput.away} />
                                <input name="aiReason" type="hidden" value={aiAnalysis ? aiAnalysis.reason : ''} />
                                
                                {/* Visible fields auto-filled or manual */}
                                <div className="col-span-1">
                                    <label className="text-[10px] text-slate-500">Home Team</label>
                                    <div className="bg-slate-900 p-2 rounded text-xs text-slate-300">{aiInput.home || 'Type above'}</div>
                                </div>
                                <div className="col-span-1">
                                    <label className="text-[10px] text-slate-500">Away Team</label>
                                    <div className="bg-slate-900 p-2 rounded text-xs text-slate-300">{aiInput.away || 'Type above'}</div>
                                </div>

                                <div className="col-span-1">
                                    <label className="text-[10px] text-slate-500">Prediction</label>
                                    <input name="prediction" defaultValue={aiAnalysis ? aiAnalysis.tip : ''} placeholder="Tip" className="w-full bg-slate-900 p-2 rounded text-xs text-white border border-slate-600" required />
                                </div>
                                <div className="col-span-1">
                                    <label className="text-[10px] text-slate-500">Confidence %</label>
                                    <input name="prob" type="number" defaultValue={aiAnalysis ? aiAnalysis.prob : ''} placeholder="%" className="w-full bg-slate-900 p-2 rounded text-xs text-white border border-slate-600" required />
                                </div>

                                <button className="col-span-2 bg-blue-600 py-2 rounded font-bold text-sm mt-2 hover:bg-blue-500">Post Match</button>
                            </form>
                        </div>

                        {/* VIP Poster */}
                        <div className="bg-slate-800 p-4 rounded-xl border border-yellow-600/30 mb-6">
                            <h3 className="font-bold mb-2 text-yellow-400">üëë Post VIP Code</h3>
                            <form onSubmit={postVip} className="grid grid-cols-2 gap-2">
                                <input name="bookie" placeholder="Bookie" className="bg-slate-900 p-2 rounded text-xs text-white" required/>
                                <input name="code" placeholder="Code" className="bg-slate-900 p-2 rounded text-xs text-white" required/>
                                <input name="odds" placeholder="Odds" className="bg-slate-900 p-2 rounded text-xs text-white" required/>
                                <button className="col-span-2 bg-yellow-600 text-black py-2 rounded font-bold text-sm mt-2">Post VIP</button>
                            </form>
                            <div className="mt-4 space-y-2">
                                {vipCodes.map(v => (
                                    <div key={v.id} className="bg-slate-900 p-2 rounded flex justify-between items-center text-xs border border-slate-700">
                                        <span>{v.bookie}: {v.code}</span>
                                        <button onClick={()=>deleteItem('vip', v.id)} className="text-red-500 bg-red-900/20 px-2 py-1 rounded">Del</button>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Match List */}
                        <div className="space-y-2 mb-6">
                            <h3 className="font-bold text-xs text-slate-400 mb-1">Active Matches</h3>
                            {matches.map(m => (
                                <div key={m.id} className="bg-slate-800 p-3 rounded flex justify-between items-center text-xs border border-slate-700">
                                    <span>{m.home} vs {m.away} ({m.prediction})</span>
                                    <button onClick={()=>deleteItem('match', m.id)} className="text-red-500 bg-red-900/20 px-2 py-1 rounded">Del</button>
                                </div>
                            ))}
                        </div>

                        {/* User List */}
                        <div className="bg-slate-800 p-4 rounded-xl border border-green-600/30">
                            <h3 className="font-bold mb-3 text-green-400">üë• Users ({allUsers.length})</h3>
                            <div className="max-h-64 overflow-y-auto space-y-2 pr-1">
                                {allUsers.map(u => (
                                    <div key={u.email} className="bg-slate-900 p-2 rounded-lg border border-slate-700">
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <div className="font-bold text-sm text-white">{u.name}</div>
                                                <div className="text-xs text-slate-400">{u.email}</div>
                                            </div>
                                            {u.isPremium 
                                                ? <span className="bg-yellow-500 text-black text-[10px] font-bold px-2 py-0.5 rounded">VIP</span>
                                                : <span className="bg-slate-700 text-slate-400 text-[10px] font-bold px-2 py-0.5 rounded">FREE</span>
                                            }
                                        </div>
                                        <div className="flex gap-2">
                                            {u.isPremium && <button onClick={()=>revokeVip(u.email)} className="flex-1 bg-orange-900/30 text-orange-400 py-1 rounded text-[10px]">Revoke</button>}
                                            <button onClick={()=>removeUser(u.email)} className="flex-1 bg-red-900/30 text-red-400 py-1 rounded text-[10px]">Delete</button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            // --- USER DASHBOARD ---
            return (
                <div className="bg-slate-900 min-h-screen text-white pb-24 fade-in">
                    {/* Header */}
                    <header className="sticky top-0 bg-slate-900/90 backdrop-blur-md border-b border-slate-800 p-4 flex justify-between items-center z-10">
                        <div className="flex items-center gap-2">
                            <span className="text-2xl">ü§ñ</span>
                            <span className="font-black italic">KOA<span className="text-green-500">BET</span></span>
                        </div>
                        <div className="flex items-center gap-3">
                            {currentUser?.isPremium && <span className="bg-yellow-500/20 text-yellow-500 px-2 py-0.5 rounded text-[10px] font-bold border border-yellow-500/30">VIP</span>}
                            <button onClick={handleLogout} className="text-xs text-slate-400">Logout</button>
                        </div>
                    </header>

                    {/* Content */}
                    <main className="p-4 space-y-4">
                        {activeTab === 'matches' && (
                            <>
                                <div className="bg-slate-800 p-4 rounded-xl border border-blue-500/20 text-center">
                                    <h2 className="font-bold text-lg">Today's Tips</h2>
                                    <p className="text-xs text-slate-400">Powered by AI Analysis</p>
                                </div>
                                {matches.length === 0 ? (
                                    <p className="text-center text-slate-500 py-10">No matches posted yet.</p>
                                ) : (
                                    matches.map(m => (
                                        <div key={m.id} className="bg-slate-800 p-4 rounded-2xl border border-slate-700 relative overflow-hidden mb-3">
                                            <div className="flex justify-between text-[10px] text-slate-400 mb-2">
                                                <span className="bg-slate-700 text-white px-2 py-0.5 rounded">{m.league}</span>
                                                <span>‚è∞ {m.time}</span>
                                            </div>
                                            <div className="flex justify-between items-center mb-3 font-bold text-sm">
                                                <span>{m.home}</span>
                                                <span className="text-slate-500 text-xs">VS</span>
                                                <span>{m.away}</span>
                                            </div>
                                            
                                            {/* AI STATS VISUALIZATION FOR USER */}
                                            {m.aiReason && (
                                                <div className="bg-purple-900/20 p-2 rounded mb-2 text-[10px] text-purple-300 border border-purple-500/20 italic">
                                                    ü§ñ AI: {m.aiReason}
                                                </div>
                                            )}

                                            <div className="bg-slate-900/50 p-2 rounded-lg flex justify-between items-center border border-slate-700">
                                                <span className="text-xs text-slate-300">Tip: <b className="text-green-400 ml-1">{m.prediction}</b></span>
                                                <span className="text-[10px] text-green-600 font-bold">{m.prob}% Safe</span>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </>
                        )}

                        {activeTab === 'magic' && (
                            <div className="space-y-4">
                                <div className="bg-gradient-to-br from-purple-900 to-indigo-900 rounded-2xl p-5 text-white relative overflow-hidden shadow-xl">
                                    <div className="relative z-10">
                                        <h2 className="text-xl font-bold flex items-center gap-2 mb-1">
                                            <ZapIcon /> Magic Bet
                                        </h2>
                                        <p className="text-indigo-200 text-xs">Mkeka Maalum wa Uhakika (Safe Odds)</p>
                                    </div>
                                </div>
                                {magicSlip.length === 0 ? (
                                    <p className="text-center text-slate-500 py-10">Hakuna mechi za uhakika kwa sasa.</p>
                                ) : (
                                    <div className="bg-slate-800 rounded-xl p-4 border border-purple-500/30">
                                        <h3 className="font-bold text-purple-400 mb-4 border-b border-slate-700 pb-2">Mkeka wa Leo</h3>
                                        <div className="space-y-3">
                                            {magicSlip.map(m => (
                                                <div key={m.id} className="flex justify-between items-center text-sm border-b border-slate-700/50 pb-2 last:border-0">
                                                    <div>
                                                        <div className="font-bold">{m.home} vs {m.away}</div>
                                                        <div className="text-xs text-slate-400">{m.prediction}</div>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="text-green-400 font-bold">{m.prob}%</div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="mt-4 pt-3 border-t border-slate-700 text-center">
                                            <button className="w-full bg-purple-600 py-2 rounded font-bold text-sm">Copy Code</button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'vip' && (
                            <div className="space-y-4">
                                {!currentUser?.isPremium ? (
                                    <div className="bg-slate-800 rounded-2xl p-8 text-center border border-yellow-500/30 shadow-lg">
                                        <div className="text-4xl mb-4">üëë</div>
                                        <h2 className="text-2xl font-black mb-2">VIP ACCESS</h2>
                                        <p className="text-slate-400 text-sm mb-6">Get 100% Sure Odds & Fixed Matches</p>
                                        <button onClick={()=>setShowPayModal(true)} className="w-full bg-yellow-500 text-black font-bold py-3 rounded-xl animate-pulse">JOIN VIP NOW</button>
                                    </div>
                                ) : (
                                    <>
                                        <div className="bg-green-900/20 p-4 rounded-xl border border-green-500 text-center mb-4">
                                            <h3 className="font-bold text-green-400">VIP ACTIVE ‚úÖ</h3>
                                        </div>
                                        {vipCodes.length === 0 ? <p className="text-center text-slate-500">No codes yet.</p> : vipCodes.map(v => (
                                            <div key={v.id} className="bg-slate-800 p-4 rounded-xl border border-yellow-500/30 relative overflow-hidden mb-3">
                                                <div className="absolute top-0 right-0 bg-yellow-500 text-black text-[10px] font-bold px-2 py-1 rounded-bl">
                                                    {v.bookie}
                                                </div>
                                                <div className="text-xs text-slate-400 mb-1">Booking Code</div>
                                                <div className="text-2xl font-mono font-black text-white tracking-widest">{v.code}</div>
                                                <div className="mt-2 text-sm text-yellow-400 font-bold">Total Odds: {v.odds}</div>
                                            </div>
                                        ))}
                                    </>
                                )}
                            </div>
                        )}

                        {activeTab === 'profile' && (
                             <div className="bg-slate-800 p-6 rounded-xl border border-slate-700">
                                <div className="text-center mb-6">
                                    <div className="w-16 h-16 bg-green-600 rounded-full mx-auto flex items-center justify-center text-2xl font-bold mb-3">{currentUser?.name?.[0] || 'U'}</div>
                                    <h2 className="font-bold text-xl">{currentUser?.name || 'User'}</h2>
                                    <p className="text-xs text-slate-400">{currentUser?.email}</p>
                                </div>
                                <div className="border-t border-slate-700 pt-4 space-y-2 text-sm">
                                    <div className="flex justify-between">
                                        <span className="text-slate-400">Status</span>
                                        <span className={currentUser?.isPremium ? "text-yellow-400 font-bold" : "text-slate-200"}>{currentUser?.isPremium ? 'VIP Member' : 'Free User'}</span>
                                    </div>
                                    {!currentUser?.isPremium && <button onClick={()=>setShowPayModal(true)} className="w-full mt-4 bg-slate-700 py-2 rounded text-xs font-bold">Upgrade</button>}
                                </div>
                             </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 w-full max-w-[480px] bg-slate-900/95 border-t border-slate-800 p-2 flex justify-around backdrop-blur-md">
                         <button onClick={()=>setActiveTab('matches')} className={`p-2 flex flex-col items-center ${activeTab==='matches'?'text-green-500':'text-slate-500'}`}><span className="text-xl">üìÖ</span><span className="text-[10px]">Tips</span></button>
                         <button onClick={()=>setActiveTab('magic')} className={`p-2 flex flex-col items-center ${activeTab==='magic'?'text-purple-500':'text-slate-500'}`}><span className="text-xl">‚ö°</span><span className="text-[10px]">Magic</span></button>
                         <button onClick={()=>setActiveTab('vip')} className={`p-2 flex flex-col items-center ${activeTab==='vip'?'text-yellow-500':'text-slate-500'}`}><span className="text-xl">üëë</span><span className="text-[10px]">VIP</span></button>
                         <button onClick={()=>setActiveTab('profile')} className={`p-2 flex flex-col items-center ${activeTab==='profile'?'text-blue-500':'text-slate-500'}`}><span className="text-xl">üë§</span><span className="text-[10px]">Me</span></button>
                    </nav>

                    {showPayModal && (
                        <div className="fixed inset-0 bg-black/90 z-50 flex items-end justify-center">
                            <div className="bg-slate-800 w-full max-w-[480px] rounded-t-2xl p-6 animate-slide-up">
                                <div className="flex justify-between mb-4"><h3 className="font-bold">Select Package</h3><button onClick={()=>setShowPayModal(false)} className="text-slate-400">‚úï</button></div>
                                <div className="grid grid-cols-3 gap-2 mb-4">
                                    {PACKAGES.map(p => (
                                        <button key={p.id} onClick={()=>setSelectedPlan(p.id)} className={`p-2 rounded border ${selectedPlan===p.id ? 'border-green-500 bg-green-500/10 text-white' : 'border-slate-700 text-slate-400'} text-xs font-bold`}>{p.name}<br/>{p.label}</button>
                                    ))}
                                </div>
                                <div className="bg-yellow-500/10 border border-yellow-500/20 p-3 rounded mb-4 text-center">
                                    <p className="text-[10px] text-yellow-500 uppercase font-bold">Lipa Namba (Voda)</p>
                                    <p className="text-2xl font-mono font-black tracking-widest my-1">52017017</p>
                                    <p className="text-[10px] text-slate-400">MR JUMBO SUPPLIES</p>
                                </div>
                                <input placeholder="Enter Code Received" value={activationCode} onChange={e=>setActivationCode(e.target.value)} className="w-full bg-slate-900 p-3 rounded-xl border border-slate-700 text-center font-bold text-white mb-3" />
                                <button onClick={verifyCode} className="w-full bg-green-600 py-3 rounded-xl font-bold">Verify Payment</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
